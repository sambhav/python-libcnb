
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Cloud Native Buildpack API bindings for Python">
      
      
      
        <meta name="author" content="Sambhav Kothari">
      
      
      <link rel="shortcut icon" href="assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.1.2, mkdocs-material-6.2.8">
    
    
      
        <title>libcnb</title>
      
    
    
      <link rel="stylesheet" href="assets/stylesheets/main.cb6bc1d0.min.css">
      
        
        <link rel="stylesheet" href="assets/stylesheets/palette.39b8e14a.min.css">
        
      
    
    
    
      
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto",-apple-system,BlinkMacSystemFont,Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono",SFMono-Regular,Consolas,Menlo,monospace}</style>
      
    
    
    
      <link rel="stylesheet" href="assets/_mkdocstrings.css">
    
    
      
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="none" data-md-color-accent="none">
      
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#libcnb" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid" aria-label="Header">
    <a href="." title="libcnb" class="md-header-nav__button md-logo" aria-label="libcnb">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 003-3 3 3 0 00-3-3 3 3 0 00-3 3 3 3 0 003 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    <label class="md-header-nav__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header-nav__title" data-md-component="header-title">
      <div class="md-header-nav__ellipsis">
        <div class="md-header-nav__topic">
          <span class="md-ellipsis">
            libcnb
          </span>
        </div>
        <div class="md-header-nav__topic">
          <span class="md-ellipsis">
            
              Home
            
          </span>
        </div>
      </div>
    </div>
    
      <label class="md-header-nav__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" data-md-state="active" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <button type="reset" class="md-search__icon md-icon" aria-label="Clear" data-md-component="search-reset" tabindex="-1">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header-nav__source">
        
<a href="https://github.com/samj1912/python-libcnb" title="Go to repository" class="md-source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
  </div>
  <div class="md-source__repository">
    samj1912/python-libcnb
  </div>
</a>
      </div>
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-tabs__inner md-grid">
    <ul class="md-tabs__list">
      
        
  
  
    
  


  <li class="md-tabs__item">
    <a href="." class="md-tabs__link md-tabs__link--active">
      Home
    </a>
  </li>

      
        
  
  


  <li class="md-tabs__item">
    <a href="api/" class="md-tabs__link">
      API Reference
    </a>
  </li>

      
    </ul>
  </div>
</nav>
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="." title="libcnb" class="md-nav__button md-logo" aria-label="libcnb">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 003-3 3 3 0 00-3-3 3 3 0 00-3 3 3 3 0 003 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    libcnb
  </label>
  
    <div class="md-nav__source">
      
<a href="https://github.com/samj1912/python-libcnb" title="Go to repository" class="md-source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
  </div>
  <div class="md-source__repository">
    samj1912/python-libcnb
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Home
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="." class="md-nav__link md-nav__link--active">
        Home
      </a>
      
        
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#usage" class="md-nav__link">
    Usage
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#buildpack-interface" class="md-nav__link">
    Buildpack Interface
  </a>
  
    <nav class="md-nav" aria-label="Buildpack Interface">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#detect-phase" class="md-nav__link">
    Detect Phase
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#build-phase" class="md-nav__link">
    Build Phase
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#run" class="md-nav__link">
    Run
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#summary" class="md-nav__link">
    Summary
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="api/" class="md-nav__link">
        API Reference
      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#usage" class="md-nav__link">
    Usage
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#buildpack-interface" class="md-nav__link">
    Buildpack Interface
  </a>
  
    <nav class="md-nav" aria-label="Buildpack Interface">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#detect-phase" class="md-nav__link">
    Detect Phase
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#build-phase" class="md-nav__link">
    Build Phase
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#run" class="md-nav__link">
    Run
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#summary" class="md-nav__link">
    Summary
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                <h1 id="libcnb">libcnb</h1>
<p>Cloud Native Buildpack API bindings for Python</p>
<h2 id="usage">Usage</h2>
<p>You can install <code>libcnb</code> from PyPi via - </p>
<div class="highlight"><pre><span></span><code>pip install libcnb
</code></pre></div>
<h2 id="buildpack-interface">Buildpack Interface</h2>
<p>According to the CNB specification, the buildpack interface is composed of both
a detect and build phase. Each of these phases has a corresponding set of
libcnb primitives enable developers to easily implement a buildpack.</p>
<p>For more details see the <a href="https://buildpacks.io/docs/reference/spec/buildpack-api/">Cloud Native Buildpack Spec</a></p>
<h3 id="detect-phase">Detect Phase</h3>
<p>The purpose of the detect phase is for buildpacks to declare dependencies
that are provided or required for the buildpack to execute. Implementing the
detect phase can be achieved by calling the <code>detect</code> function and providing a
<code>detector</code> callback to be invoked during that phase. Below is an example of
a simple detect phase that provides the "pip" dependency and requires the
"python" dependency.</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">libcnb</span>


<span class="k">def</span> <span class="nf">detector</span><span class="p">(</span><span class="n">context</span><span class="p">:</span> <span class="n">libcnb</span><span class="o">.</span><span class="n">DetectContext</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">libcnb</span><span class="o">.</span><span class="n">DetectResult</span><span class="p">:</span>
    <span class="c1"># The DetectContext includes an application_dir field that </span>
    <span class="c1"># specifies the location of the application source code. </span>
    <span class="c1"># This field can be combined with other paths to find and</span>
    <span class="c1"># inspect files included in the application source</span>
    <span class="c1"># code that is provided to the buildpack.</span>
    <span class="n">has_requirements_file</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">context</span><span class="o">.</span><span class="n">application_dir</span> <span class="o">/</span> <span class="s2">&quot;requirements.txt&quot;</span>
    <span class="p">)</span><span class="o">.</span><span class="n">exists</span><span class="p">()</span>

    <span class="c1"># Once the existence of a requirements.txt file has been confirmed,</span>
    <span class="c1"># the detect phase can return a result that indicates the provision</span>
    <span class="c1"># of pip and the requirement of python. As can be seen below,</span>
    <span class="c1"># the BuildPlanRequire may also include optional metadata information</span>
    <span class="c1"># such as the the version information for a given requirement.</span>

    <span class="c1"># By default the result is initialized to </span>
    <span class="c1"># `passed` = False and has empty build plans</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">libcnb</span><span class="o">.</span><span class="n">DetectResult</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">has_requirements_file</span><span class="p">:</span>
        <span class="n">result</span><span class="o">.</span><span class="n">passed</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="c1"># The detect phase provides pip and requires python.</span>
        <span class="c1"># When requiring python, it requests a version greater</span>
        <span class="c1"># than 3 as being acceptable by this buildpack.</span>
        <span class="n">result</span><span class="o">.</span><span class="n">plans</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="n">libcnb</span><span class="o">.</span><span class="n">BuildPlan</span><span class="p">(</span>
                <span class="n">provides</span><span class="o">=</span><span class="p">[</span>
                    <span class="n">libcnb</span><span class="o">.</span><span class="n">BuildPlanProvide</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;pip&quot;</span><span class="p">),</span>
                <span class="p">],</span>
                <span class="n">requires</span><span class="o">=</span><span class="p">[</span>
                    <span class="n">libcnb</span><span class="o">.</span><span class="n">BuildPlanRequire</span><span class="p">(</span>
                        <span class="n">name</span><span class="o">=</span><span class="s2">&quot;python&quot;</span><span class="p">,</span>
                        <span class="n">metadata</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;version&quot;</span><span class="p">:</span> <span class="s2">&quot;&gt;=3&quot;</span><span class="p">},</span>
                    <span class="p">),</span>
                <span class="p">],</span>
            <span class="p">)</span>
        <span class="p">)</span>
    <span class="k">return</span> <span class="n">result</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="c1"># Calling libcnb.detect with the correct detector</span>
    <span class="n">libcnb</span><span class="o">.</span><span class="n">detect</span><span class="p">(</span><span class="n">detector</span><span class="o">=</span><span class="n">detector</span><span class="p">)</span>
</code></pre></div>
</td></tr></table>
<h3 id="build-phase">Build Phase</h3>
<p>The purpose of the build phase is to perform the operation of providing
whatever dependencies were declared in the detect phase for the given
application code. Implementing the build phase can be achieved by calling
the <code>build</code> function and providing a <code>builder</code> callback to be invoked during
that phase. Below is an example that adds "pip" as a dependency to the
application source code.</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span>
<span class="normal">87</span>
<span class="normal">88</span>
<span class="normal">89</span>
<span class="normal">90</span>
<span class="normal">91</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>

<span class="kn">import</span> <span class="nn">libcnb</span>


<span class="k">def</span> <span class="nf">builder</span><span class="p">(</span><span class="n">context</span><span class="p">:</span> <span class="n">libcnb</span><span class="o">.</span><span class="n">BuildContext</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">libcnb</span><span class="o">.</span><span class="n">BuildResult</span><span class="p">:</span>
    <span class="c1"># The BuildContext includes a BuildpackPlan with entries</span>
    <span class="c1"># that specify a requirement on a dependency provided by</span>
    <span class="c1"># the buildpack. This example simply chooses the first entry,</span>
    <span class="c1"># but more intelligent resolution processes can and likely</span>
    <span class="c1"># should be used in real implementations.</span>
    <span class="n">entry</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="n">plan</span><span class="o">.</span><span class="n">entries</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">pip_version</span> <span class="o">=</span> <span class="n">entry</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;version&quot;</span><span class="p">]</span>

    <span class="c1"># The BuildContext also provides a mechanism whereby</span>
    <span class="c1"># a layer can be created to store the results of a given</span>
    <span class="c1"># portion of the build process. This example creates a</span>
    <span class="c1"># layer called &quot;pip&quot; that will hold the pip cli.</span>
    <span class="c1"># We can also pass `load_all` to `get` set to `True`</span>
    <span class="c1"># to load all the existing layer metadata including env vars</span>
    <span class="c1"># and profile.d scripts if they exist.</span>
    <span class="c1"># Otherwise the layer is loaded only with the layer.metadata</span>
    <span class="c1"># hydrated from the &lt;layer&gt;.toml file.</span>

    <span class="n">layer</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;pip&quot;</span><span class="p">,</span> <span class="n">load_all</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="c1"># libcnb.Layer also provides some handy utilities to check</span>
    <span class="c1"># the expected metadata with the actual metadata and reset</span>
    <span class="c1"># the existing content from cache if it isn&#39;t what is expected.</span>
    <span class="n">expected_metadata</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;pip_version&quot;</span><span class="p">:</span> <span class="n">pip_version</span><span class="p">}</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">layer</span><span class="o">.</span><span class="n">compare_metadata</span><span class="p">(</span><span class="n">expected_metadata</span><span class="p">,</span> <span class="n">exact</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="c1"># Clear all the existing content of the layer if the</span>
        <span class="c1"># version is not what we expect.</span>
        <span class="n">layer</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>
        <span class="n">layer</span><span class="o">.</span><span class="n">metadata</span> <span class="o">=</span> <span class="n">expected_metadata</span>
        <span class="c1"># We can also set env. variables</span>
        <span class="n">layer</span><span class="o">.</span><span class="n">shared_env</span><span class="o">.</span><span class="n">default</span><span class="p">(</span>
            <span class="s2">&quot;PIP_INDEX_URL&quot;</span><span class="p">,</span> <span class="s2">&quot;http://mypypi.org/simple&quot;</span>
        <span class="p">)</span>
        <span class="c1"># Or add profile.d scripts</span>
        <span class="n">layer</span><span class="o">.</span><span class="n">profile</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s2">&quot;pip.sh&quot;</span><span class="p">,</span> <span class="s2">&quot;export PIP_USER=1&quot;</span><span class="p">)</span>
        <span class="n">_install_pip</span><span class="p">(</span><span class="n">layer</span><span class="o">.</span><span class="n">path</span><span class="p">,</span> <span class="n">pip_version</span><span class="p">)</span>
    <span class="c1"># We can also set the layer types and metadata easily</span>
    <span class="n">layer</span><span class="o">.</span><span class="n">launch</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">layer</span><span class="o">.</span><span class="n">build</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">layer</span><span class="o">.</span><span class="n">cache</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="c1"># After the installation of the pip cli, a BuildResult</span>
    <span class="c1"># can be returned that included details of the executed</span>
    <span class="c1"># BuildpackPlan, the Layers to provide back to the lifecycle</span>
    <span class="c1"># and the Processes to execute at launch.</span>

    <span class="c1"># NOTE - Only the layers provided in the BuildResult will be exported.</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">libcnb</span><span class="o">.</span><span class="n">BuildResult</span><span class="p">(</span>
        <span class="n">layers</span><span class="o">=</span><span class="p">[</span><span class="n">layer</span><span class="p">],</span>
        <span class="n">launch_metadata</span><span class="o">=</span><span class="n">libcnb</span><span class="o">.</span><span class="n">LaunchMetadata</span><span class="p">(</span>
            <span class="n">labels</span><span class="o">=</span><span class="p">[</span><span class="n">libcnb</span><span class="o">.</span><span class="n">Label</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s2">&quot;pip-installed&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="s2">&quot;true&quot;</span><span class="p">)],</span>
        <span class="p">),</span>
    <span class="p">)</span>
    <span class="n">result</span><span class="o">.</span><span class="n">launch_metadata</span><span class="o">.</span><span class="n">processes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
        <span class="n">libcnb</span><span class="o">.</span><span class="n">Process</span><span class="p">(</span>
            <span class="n">type_</span><span class="o">=</span><span class="s2">&quot;pip-installer&quot;</span><span class="p">,</span>
            <span class="n">command</span><span class="o">=</span><span class="s2">&quot;pip&quot;</span><span class="p">,</span>
            <span class="n">args</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;install&quot;</span><span class="p">],</span>
            <span class="n">direct</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="p">)</span>
    <span class="c1"># We can also add a bom (Bill of Materials) to the output image.</span>
    <span class="n">result</span><span class="o">.</span><span class="n">launch_metadata</span><span class="o">.</span><span class="n">bom</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
        <span class="n">libcnb</span><span class="o">.</span><span class="n">BOMEntry</span><span class="p">(</span>
            <span class="n">name</span><span class="o">=</span><span class="s2">&quot;pip&quot;</span><span class="p">,</span>
            <span class="n">metadata</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;version&quot;</span><span class="p">:</span> <span class="n">pip_version</span><span class="p">},</span>
        <span class="p">)</span>
    <span class="p">)</span>
    <span class="n">result</span><span class="o">.</span><span class="n">build_metadata</span><span class="o">.</span><span class="n">bom</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
        <span class="n">libcnb</span><span class="o">.</span><span class="n">BOMEntry</span><span class="p">(</span>
            <span class="n">name</span><span class="o">=</span><span class="s2">&quot;pip&quot;</span><span class="p">,</span>
            <span class="n">metadata</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;version&quot;</span><span class="p">:</span> <span class="n">pip_version</span><span class="p">},</span>
        <span class="p">)</span>

    <span class="p">)</span>
    <span class="k">return</span> <span class="n">result</span>


<span class="c1"># Executes the process of installing the pip cli.</span>
<span class="k">def</span> <span class="nf">_install_pip</span><span class="p">(</span><span class="n">layer_path</span><span class="p">:</span> <span class="n">Path</span><span class="p">,</span> <span class="n">version</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="c1"># Implemention omitted.</span>
    <span class="k">pass</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">libcnb</span><span class="o">.</span><span class="n">build</span><span class="p">(</span><span class="n">builder</span><span class="p">)</span>
</code></pre></div>
</td></tr></table>
<h3 id="run">Run</h3>
<p>Buildpacks can be created with a single entrypoint executable using the
<code>run</code> function. Here, you can combine both the <code>Detect</code> and <code>Build</code> phases
and <code>run</code> will ensure that the correct phase is called when the matching
executable is called by the Cloud Native Buildpack Lifecycle. Below is an
example that combines a simple <code>detect</code> and <code>build</code> into a single python script.</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">libcnb</span>

<span class="k">def</span> <span class="nf">detector</span><span class="p">(</span><span class="n">context</span><span class="p">:</span> <span class="n">libcnb</span><span class="o">.</span><span class="n">DetectContext</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">libcnb</span><span class="o">.</span><span class="n">DetectResult</span><span class="p">:</span>
    <span class="k">return</span> <span class="n">libcnb</span><span class="o">.</span><span class="n">DetectResult</span><span class="p">(</span><span class="n">passed</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">builder</span><span class="p">(</span><span class="n">context</span><span class="p">:</span> <span class="n">libcnb</span><span class="o">.</span><span class="n">BuildContext</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">libcnb</span><span class="o">.</span><span class="n">BuildResult</span><span class="p">:</span>
    <span class="k">return</span> <span class="n">libcnb</span><span class="o">.</span><span class="n">BuildResult</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="n">libcnb</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">detector</span><span class="o">=</span><span class="n">detector</span><span class="p">,</span> <span class="n">builder</span><span class="o">=</span><span class="n">detector</span><span class="p">)</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">main</span><span class="p">()</span>
</code></pre></div>
</td></tr></table>
<h3 id="summary">Summary</h3>
<p>These examples show the very basics of what a buildpack implementation using
<code>libcnb</code> might entail. For more details, please consult the <a href="api/">API Reference</a> for
the types and functions declared within the <code>libcnb</code> package.</p>
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid" aria-label="Footer">
        
        
          <a href="api/" class="md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-footer-nav__title">
              <div class="md-ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                API Reference
              </div>
            </div>
            <div class="md-footer-nav__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            Copyright &copy; 2021 Sambhav Kothari
          </div>
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
      </div>
      
  <div class="md-footer-social">
    
      
      
      <a href="https://github.com/samj1912" target="_blank" rel="noopener" title="samj1912 on GitHub" class="md-footer-social__link">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
      </a>
    
  </div>

    </div>
  </div>
</footer>
      
    </div>
    
      <script src="assets/javascripts/vendor.18f0862e.min.js"></script>
      <script src="assets/javascripts/bundle.994580cf.min.js"></script><script id="__lang" type="application/json">{"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing"}</script>
      
      <script>
        app = initialize({
          base: ".",
          features: ['navigation.instant', 'navigation.tabs'],
          search: Object.assign({
            worker: "assets/javascripts/worker/search.9c0e82ba.min.js"
          }, typeof search !== "undefined" && search)
        })
      </script>
      
    
  </body>
</html>